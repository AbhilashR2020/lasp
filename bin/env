#!/bin/bash

# Get instance IP.
if [ -z "$IP" ]; then
    export IP=localhost
fi

# Use mesos task id as node name, else, use the default.
if [ ! -z "$MESOS_TASK_ID" ]; then
    export NODE_NAME=lasp-${PORT0}@${IP}
fi

if [ -z "$NODE_NAME" ]; then
    export NODE_NAME=lasp@${IP}
fi

export RELX_REPLACE_OS_VARS=true
export COOKIE=lasp
export WEB_PORT=${PORT0}

echo "MESOS_TASK_ID: ${MESOS_TASK_ID}"
echo "PORT0: ${PORT0}"
echo "WEB_PORT: ${WEB_PORT}"
echo "NODE_NAME: ${NODE_NAME}"
echo "COOKIE: ${COOKIE}"

exec _build/default/rel/lasp/bin/lasp foreground "$@"
